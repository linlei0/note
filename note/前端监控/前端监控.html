<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å‰ç«¯æ€§èƒ½ç›‘æ§ | linlei space</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="æˆåŠŸåªä¼šæ·˜æ±°æ‡’æƒ°çš„äººï¼Œå¹³åº¸ä¹Ÿéœ€è¦åŠªåŠ›ï¼">
    
    <link rel="preload" href="/note/assets/css/0.styles.19e75038.css" as="style"><link rel="preload" href="/note/assets/js/app.c6304b87.js" as="script"><link rel="preload" href="/note/assets/js/2.a2d0eb10.js" as="script"><link rel="preload" href="/note/assets/js/4.9d6e3d9e.js" as="script"><link rel="prefetch" href="/note/assets/js/10.d5bef132.js"><link rel="prefetch" href="/note/assets/js/11.aa78d929.js"><link rel="prefetch" href="/note/assets/js/12.ef4442d7.js"><link rel="prefetch" href="/note/assets/js/13.c5688707.js"><link rel="prefetch" href="/note/assets/js/14.0dfd4ee4.js"><link rel="prefetch" href="/note/assets/js/15.ec4f8daa.js"><link rel="prefetch" href="/note/assets/js/16.b8d96dd4.js"><link rel="prefetch" href="/note/assets/js/17.44624e3f.js"><link rel="prefetch" href="/note/assets/js/18.87bd74bd.js"><link rel="prefetch" href="/note/assets/js/19.127ba64c.js"><link rel="prefetch" href="/note/assets/js/20.83b9bea0.js"><link rel="prefetch" href="/note/assets/js/21.3f6696a5.js"><link rel="prefetch" href="/note/assets/js/22.cd3cf361.js"><link rel="prefetch" href="/note/assets/js/23.58727000.js"><link rel="prefetch" href="/note/assets/js/24.5d556bdf.js"><link rel="prefetch" href="/note/assets/js/25.eabd6b90.js"><link rel="prefetch" href="/note/assets/js/26.25651788.js"><link rel="prefetch" href="/note/assets/js/27.674ff129.js"><link rel="prefetch" href="/note/assets/js/28.5d18aa1a.js"><link rel="prefetch" href="/note/assets/js/29.80917de0.js"><link rel="prefetch" href="/note/assets/js/3.0ae971d3.js"><link rel="prefetch" href="/note/assets/js/30.33fc57b8.js"><link rel="prefetch" href="/note/assets/js/31.5717187d.js"><link rel="prefetch" href="/note/assets/js/32.207dc144.js"><link rel="prefetch" href="/note/assets/js/33.eacc0a06.js"><link rel="prefetch" href="/note/assets/js/34.f62e8bc5.js"><link rel="prefetch" href="/note/assets/js/35.f037653f.js"><link rel="prefetch" href="/note/assets/js/36.68c6d429.js"><link rel="prefetch" href="/note/assets/js/37.a08ca271.js"><link rel="prefetch" href="/note/assets/js/38.e562a302.js"><link rel="prefetch" href="/note/assets/js/39.f753c113.js"><link rel="prefetch" href="/note/assets/js/40.d5598f6f.js"><link rel="prefetch" href="/note/assets/js/41.7eb0f80e.js"><link rel="prefetch" href="/note/assets/js/42.b82baf99.js"><link rel="prefetch" href="/note/assets/js/43.fc8700e7.js"><link rel="prefetch" href="/note/assets/js/44.231ec0ab.js"><link rel="prefetch" href="/note/assets/js/45.24cb8c53.js"><link rel="prefetch" href="/note/assets/js/46.dc025458.js"><link rel="prefetch" href="/note/assets/js/47.01e5f0c9.js"><link rel="prefetch" href="/note/assets/js/48.fd02986f.js"><link rel="prefetch" href="/note/assets/js/49.cc90f08f.js"><link rel="prefetch" href="/note/assets/js/5.f242cb95.js"><link rel="prefetch" href="/note/assets/js/50.de6a1463.js"><link rel="prefetch" href="/note/assets/js/51.87741b04.js"><link rel="prefetch" href="/note/assets/js/52.013faf73.js"><link rel="prefetch" href="/note/assets/js/6.40586fd5.js"><link rel="prefetch" href="/note/assets/js/7.ede2eeee.js"><link rel="prefetch" href="/note/assets/js/8.df0e579a.js"><link rel="prefetch" href="/note/assets/js/9.cd9721a3.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.19e75038.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">linlei space</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/note/" class="nav-link router-link-active">
  åšå®¢
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç®—æ³•" class="dropdown-title"><span class="title">ç®—æ³•</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç®—æ³•" class="mobile-dropdown-title"><span class="title">ç®—æ³•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  æ¯æ—¥
</a></li><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  LeetCode
</a></li></ul></div></div> <a href="https://github.com//" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/note/" class="nav-link router-link-active">
  åšå®¢
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç®—æ³•" class="dropdown-title"><span class="title">ç®—æ³•</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç®—æ³•" class="mobile-dropdown-title"><span class="title">ç®—æ³•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  æ¯æ—¥
</a></li><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  LeetCode
</a></li></ul></div></div> <a href="https://github.com//" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>html&amp;æµè§ˆå™¨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ€§èƒ½</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>å‰ç«¯ç›‘æ§</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.html" class="active sidebar-link">å‰ç«¯æ€§èƒ½ç›‘æ§</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.html#ä¸ºä»€ä¹ˆè¦åšå‰ç«¯ç›‘æ§" class="sidebar-link">ä¸ºä»€ä¹ˆè¦åšå‰ç«¯ç›‘æ§</a></li><li class="sidebar-sub-header"><a href="/note/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.html#å‰ç«¯ç›‘æ§ç›®æ ‡" class="sidebar-link">å‰ç«¯ç›‘æ§ç›®æ ‡</a></li><li class="sidebar-sub-header"><a href="/note/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.html#å‰ç«¯ç›‘æ§æµç¨‹" class="sidebar-link">å‰ç«¯ç›‘æ§æµç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.html#æ­å»ºsdk" class="sidebar-link">æ­å»ºSDK</a></li><li class="sidebar-sub-header"><a href="/note/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.html#é”™è¯¯ç›‘æ§sdk" class="sidebar-link">é”™è¯¯ç›‘æ§SDK</a></li><li class="sidebar-sub-header"><a href="/note/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.html#å¦‚ä½•ç›‘æ§httpè¯·æ±‚" class="sidebar-link">å¦‚ä½•ç›‘æ§httpè¯·æ±‚</a></li><li class="sidebar-sub-header"><a href="/note/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.html#ç™½å±ç›‘æ§" class="sidebar-link">ç™½å±ç›‘æ§</a></li><li class="sidebar-sub-header"><a href="/note/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.html#æ€§èƒ½æ•°æ®é‡‡é›†" class="sidebar-link">æ€§èƒ½æ•°æ®é‡‡é›†</a></li><li class="sidebar-sub-header"><a href="/note/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.html#æ›å…‰é‡‡é›†" class="sidebar-link">æ›å…‰é‡‡é›†</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="å‰ç«¯æ€§èƒ½ç›‘æ§"><a href="#å‰ç«¯æ€§èƒ½ç›‘æ§" class="header-anchor">#</a> å‰ç«¯æ€§èƒ½ç›‘æ§</h1> <h2 id="ä¸ºä»€ä¹ˆè¦åšå‰ç«¯ç›‘æ§"><a href="#ä¸ºä»€ä¹ˆè¦åšå‰ç«¯ç›‘æ§" class="header-anchor">#</a> ä¸ºä»€ä¹ˆè¦åšå‰ç«¯ç›‘æ§</h2> <ul><li>æ›´å¿«çš„å‘ç°é—®é¢˜å’Œè§£å†³é—®é¢˜</li> <li>åšäº§å“çš„å†³ç­–ä¾æ®</li> <li>ä¸ºä¸šåŠ¡æ‰©å±•æä¾›æ›´å¤šçš„å¯èƒ½æ€§</li></ul> <h2 id="å‰ç«¯ç›‘æ§ç›®æ ‡"><a href="#å‰ç«¯ç›‘æ§ç›®æ ‡" class="header-anchor">#</a> å‰ç«¯ç›‘æ§ç›®æ ‡</h2> <ul><li><p>ç¨³å®šæ€§
jsé”™è¯¯     jsæ‰§è¡Œé”™è¯¯æˆ–è€…
èµ„æºå¼‚å¸¸    scriptå’Œlinkèµ„æºåŠ è½½å¼‚å¸¸
æ¥å£é”™è¯¯    ajaxæˆ–fetchè¯·æ±‚å¼‚å¸¸
ç™½å±       é¡µé¢ç©ºç™½æ—¶é—´</p></li> <li><p>ç”¨æˆ·ä½“éªŒ
åŠ è½½æ—¶é—´                                        å„ä¸ªé˜¶æ®µçš„åŠ è½½æ—¶é—´
TTFBï¼ˆtime to firstï¼‰é¦–å­—èŠ‚æ—¶é—´                  æ˜¯æŒ‡æµè§ˆå™¨å‘èµ·ç¬¬ä¸€ä¸ªè¯·æ±‚åˆ°æ•°æ®è¿”å›ç¬¬ä¸€ä¸ªå­—èŠ‚æ‰€æ¶ˆè€—çš„æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´åŒ…å¥½äº†ç½‘ç»œè¯·æ±‚
FPï¼ˆfirst Paintï¼‰é¦–æ¬¡ç»˜åˆ¶                        é¦–æ¬¡ç»˜åˆ¶åŒ…æ‹¬ä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰çš„èƒŒæ™¯ç»˜åˆ¶ï¼Œä»–æ˜¯å°†ç¬¬ä¸€ä¸ªåƒç´ ç‚¹ç»˜åˆ¶åˆ°å±å¹•çš„æ—¶é—´
FCPï¼ˆfirst Content Paintï¼‰é¦–æ¬¡å†…å®¹ç»˜åˆ¶            ç¬¬ä¸€ä¸ªdomæ¸²æŸ“åˆ°å±å¹•çš„æ—¶é—´å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œå›¾ç‰‡ï¼Œsvgç­‰çš„æ—¶é—´
FMPï¼ˆfirst Meaningful paintï¼‰é¦–æ¬¡æœ‰æ„ä¹‰çš„ç»˜åˆ¶     é¦–æ¬¡ç»˜åˆ¶æœ‰æ„ä¹‰çš„ç»˜åˆ¶æ˜¯é¡µé¢å¯ç”¨æ€§çš„åº¦é‡æ ‡å‡†
FIDï¼ˆfirst input Delaryï¼‰é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ            ç”¨æˆ·é¦–æ¬¡å’Œé¡µé¢äº¤äº’åˆ°é¡µé¢å“åº”äº¤äº’æ—¶é—´
å¡é¡¿                                           è¶…è¿‡50msçš„é•¿ä»»åŠ¡</p></li> <li><p>ä¸šåŠ¡
PV             page view é¡µé¢çš„æµè§ˆé‡
UV             æŒ‡è®¿é—®æŸä¸ªç«™ç‚¹çš„ä¸åŒipåœ°å€çš„äººæ•°
é¡µé¢åœç•™æ—¶é—´     ç”¨æˆ·åœ¨æ¯ä¸ªé¡µé¢åœç•™çš„æ—¶é—´</p></li></ul> <h2 id="å‰ç«¯ç›‘æ§æµç¨‹"><a href="#å‰ç«¯ç›‘æ§æµç¨‹" class="header-anchor">#</a> å‰ç«¯ç›‘æ§æµç¨‹</h2> <h3 id="æ­å»ºsdk"><a href="#æ­å»ºsdk" class="header-anchor">#</a> æ­å»ºSDK</h3> <p>SDKæ¶æ„å›¾
<img src="/note/assets/img/sdk.acf5f503.jpg" alt="SDKæ¶æ„å›¾"></p> <h3 id="é”™è¯¯ç›‘æ§sdk"><a href="#é”™è¯¯ç›‘æ§sdk" class="header-anchor">#</a> é”™è¯¯ç›‘æ§SDK</h3> <h4 id="jserror"><a href="#jserror" class="header-anchor">#</a> jsError</h4> <ul><li>ä¸»åŠ¨è§¦å‘<div class="language-js extra-class"><pre class="language-js"><code>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">function</span> <span class="token function">testErr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li>æ‰‹åŠ¨è§¦å‘<div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error!!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h4 id="promiseerror"><a href="#promiseerror" class="header-anchor">#</a> promiseError</h4> <div class="language-js extra-class"><pre class="language-js"><code>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(reason, promise)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> reason <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœæ˜¯promiseè¿”å›çš„æ˜¯rejectåˆ™è¿›å…¥è¿™é‡Œ</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// reason.stack å¯ä»¥è·å–åˆ°å…·ä½“çš„é”™è¯¯è¡Œæ•°</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(data)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error!!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>æ€è€ƒğŸ¤”:ä¸ºä»€ä¹ˆwindow.onerroræ— æ³•ç›‘æ§promiseçš„é”™è¯¯?</strong></p> <p>ä¸»è¦åŸå› ï¼šwindow.onerrorä¸»è¦æ˜¯ç›‘æ§å®ä»»åŠ¡çš„é”™è¯¯æ—¥å¿—ï¼Œè€Œpromsieå±äºå¾®ä»»åŠ¡</p> <h3 id="å¦‚ä½•ç›‘æ§httpè¯·æ±‚"><a href="#å¦‚ä½•ç›‘æ§httpè¯·æ±‚" class="header-anchor">#</a> å¦‚ä½•ç›‘æ§httpè¯·æ±‚</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">injectXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> XMLHttpRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">;</span>
    <span class="token keyword">let</span> oldOpen <span class="token operator">=</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>open<span class="token punctuation">;</span>
     <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">open</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token keyword">async</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åœ¨è¿™é‡Œè¿›è¡Œä¸ŠæŠ¥æ•°æ®å¤„ç†</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loData <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">appid</span><span class="token operator">:</span> <span class="token string">'app123'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">pageid</span><span class="token operator">:</span> <span class="token string">'page123'</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">oldOpen</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">let</span> oldSend <span class="token operator">=</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>send<span class="token punctuation">;</span>
     <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">send</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span>  <span class="token function-variable function">handler</span> <span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> duration <span class="token operator">=</span> Date<span class="token punctuation">.</span>now <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
                    <span class="token keyword">let</span> status <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">;</span>
                    <span class="token keyword">let</span> statusText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">;</span>
                    <span class="token comment">// å‘é€æ•°æ®å³å¯</span>
                    <span class="token comment">// ...</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'abort'</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">oldSend</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
     <span class="token punctuation">}</span>     
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ç™½å±ç›‘æ§"><a href="#ç™½å±ç›‘æ§" class="header-anchor">#</a> ç™½å±ç›‘æ§</h3> <p>å®ç°æ€è·¯ï¼š</p> <ul><li>å°†å±å¹•åˆ†æˆè‹¥å¹²ç‚¹è¿™é‡Œä»¥18ä¸ªç‚¹æ¥å¤„ç†</li> <li>è·å–æ”¹ç‚¹ä¸‹çš„ç±»åæˆ–è€…idï¼Œå¦‚æœè¯¥ç‚¹è¿”å›wrapperElementsåˆ™è¯´æ˜è¯¥å¤„ç™½å±ï¼Œå¹¶è¿›è¡Œä¸€æ¬¡emptyPoint++æ“ä½œ</li> <li>éœ€è¦æ³¨æ„è¯¥å¤„è°ƒç”¨åº”è¯¥æ˜¯åœ¨loadä¹‹å</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">blankScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> emptyPoint <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// é¡µé¢çš„é€‰æ‹©å™¨</span>
    <span class="token keyword">const</span> wrapperElements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token string">'body'</span><span class="token punctuation">,</span> <span class="token string">'#main'</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> <span class="token function-variable function">isWrapper</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> selector <span class="token operator">=</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>wrapperElements<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            emptyPoint<span class="token operator">++</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">getSelector</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'#'</span> <span class="token operator">+</span> element<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>className<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'.'</span> <span class="token operator">+</span> element<span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> element<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å°†å±å¹•åˆ†æˆ18ä¸ªç‚¹</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> xElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            window<span class="token punctuation">.</span>innerWidth <span class="token operator">*</span> i <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">let</span> yElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            window<span class="token punctuation">.</span>innerHeight <span class="token operator">*</span> i <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token punctuation">)</span>
        <span class="token function">isWrapper</span><span class="token punctuation">(</span>xElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token function">isWrapper</span><span class="token punctuation">(</span>yElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ç™½å±</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>emptyPoint <span class="token operator">&gt;=</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å‘é€æ•°æ®</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// load</span>

<span class="token keyword">function</span> <span class="token function">onload</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>readystate<span class="token operator">===</span><span class="token string">'complete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">onload</span><span class="token punctuation">(</span>blankScreen<span class="token punctuation">)</span>

</code></pre></div><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementsFromPoint" target="_blank" rel="noopener noreferrer">document.elementsFromPointå‚è€ƒ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="æ€§èƒ½æ•°æ®é‡‡é›†"><a href="#æ€§èƒ½æ•°æ®é‡‡é›†" class="header-anchor">#</a> æ€§èƒ½æ•°æ®é‡‡é›†</h3> <p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“åˆ°åº•åˆ°åº•æœ‰å“ªäº›æŒ‡æ ‡
<img src="/note/assets/img/performance.94150ee8.png" alt="å‰ç«¯æ€§èƒ½">
ç”±ä¸Šå›¾æˆ‘ä»¬å¯ä»¥è®¡ç®—ç›¸å…³çš„å‚æ•°å¦‚ï¼šDNSè§£ææ—¶é—´ï¼ŒDOMåŠ è½½æ—¶é—´ç­‰
<img src="/note/assets/img/performanceparams.cd2f8be2.png" alt="å‰ç«¯æ€§èƒ½å‚æ•°">
eg: å¦‚ä¸‹æˆ‘ä»¬å¯ä»¥è·å–ç›¸åº”çš„å‚æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
        fetchStart<span class="token punctuation">,</span>
        connetstart<span class="token punctuation">,</span>
        connectEnd<span class="token punctuation">,</span>
        requestStart<span class="token punctuation">,</span>
        requestEnd<span class="token punctuation">,</span>
        responseStart<span class="token punctuation">,</span>
        responseEnd<span class="token punctuation">,</span>
        domLoading<span class="token punctuation">,</span>
        domInteractive<span class="token punctuation">,</span>
        domContentLoadedEventStart<span class="token punctuation">,</span>
        domContentLoadedEventEnd<span class="token punctuation">,</span>
        loadEventStart
    <span class="token punctuation">}</span> <span class="token operator">=</span> widnow<span class="token punctuation">.</span>performance<span class="token punctuation">.</span>timing<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">connectTime</span><span class="token operator">:</span> connectEnd <span class="token operator">-</span> connetstart<span class="token punctuation">,</span> <span class="token comment">//è¿æ¥æ—¶é—´</span>
        <span class="token literal-property property">ttfbTime</span><span class="token operator">:</span> requestEnd <span class="token operator">-</span> requestStart<span class="token punctuation">,</span> <span class="token comment">// é¦–å­—èŠ‚åˆ°è¾¾æ—¶é—´</span>
        <span class="token literal-property property">responseTime</span><span class="token operator">:</span> responseEnd <span class="token operator">-</span> responseEnd<span class="token punctuation">,</span> <span class="token comment">// å“åº”çš„è¯»å–æ—¶é—´</span>
        <span class="token literal-property property">parseDOMTime</span><span class="token operator">:</span> loadEventStart <span class="token operator">-</span> domLoading<span class="token punctuation">,</span> <span class="token comment">// domè§£ææ—¶é—´</span>
        <span class="token literal-property property">domContentLoadTime</span><span class="token operator">:</span> domContentLoadedEventEnd <span class="token operator">-</span> domContentLoadedEventStart<span class="token punctuation">,</span> <span class="token comment">// domåŠ è½½æ—¶é—´</span>
        <span class="token literal-property property">timeToInteractive</span><span class="token operator">:</span>  domInteractive <span class="token operator">-</span> fetchStart<span class="token punctuation">,</span> <span class="token comment">// é¦–æ¬¡å¯äº¤äº’æ—¶é—´</span>
        <span class="token literal-property property">loadTime</span><span class="token operator">:</span> loadEventStart <span class="token operator">-</span> fetchStart<span class="token punctuation">,</span> <span class="token comment">// å®Œæ•´çš„åŠ è½½æ—¶é—´</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">onload</span><span class="token punctuation">(</span>getPerformance<span class="token punctuation">)</span>
</code></pre></div><p>æœ‰äº†ä¸Šé¢çš„æ–¹æ³•ä»‹ç»æˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“çš„è·å–ç›¸å…³å‚æ•°ï¼Œä½†æ˜¯<strong>performance.timing</strong>å¹¶ä¸å¤Ÿç²¾ç¡®ï¼Œä¸€èˆ¬ä½¿ç”¨<strong>PerformanceObserver</strong>;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">observer_callback</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// FPï¼ŒFCP</span>
<span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span>observer_callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'paint'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//  LCP</span>
<span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span>observer_callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'largest-contentful-paint'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// FMP</span>
<span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span>observer_callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'element'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// è·å–FMPéœ€è¦ç»™æŒ‡å®šçš„domæ·»åŠ å‚æ•°</span>
<span class="token comment">// dom.setAttribute(&quot;elementtiming&quot;,&quot;meaningful&quot;)</span>
<span class="token comment">// FID  é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ</span>
<span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span>observer_callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'first-input'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// source</span>
<span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span>observer_callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceTiming" target="_blank" rel="noopener noreferrer">performance.timingæ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceObserver/PerformanceObserver" target="_blank" rel="noopener noreferrer">PerformanceObserveræ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="æ›å…‰é‡‡é›†"><a href="#æ›å…‰é‡‡é›†" class="header-anchor">#</a> æ›å…‰é‡‡é›†</h3> <p>å®ç°æ›å…‰ä¸€èˆ¬ä½¿ç”¨<strong>IntersectionObserver</strong>å®ç°ï¼Œå½“ç„¶é™¤äº†è¯¥APIæµè§ˆå™¨ä¹Ÿæä¾›äº†å…¶ä»–çš„API</p> <p>æ‰©å±•çŸ¥è¯†</p> <ul><li><p>IntersectionObserver
ç›‘å¬ä¸€ä¸ªå…ƒç´ å’Œå¯è§†åŒºåŸŸç›¸äº¤éƒ¨åˆ†çš„æ¯”ä¾‹ï¼Œç„¶ååœ¨å¯è§†æ¯”ä¾‹è¾¾åˆ°æŸä¸ªé˜ˆå€¼çš„æ—¶å€™è§¦å‘å›è°ƒ</p></li> <li><p>MutationObserver
ç›‘å¬ DOM æ ‘çš„å˜åŒ–ï¼ˆå±æ€§ã€å­èŠ‚ç‚¹çš„å¢åˆ æ”¹ï¼‰æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å»åšå›æº¯</p></li> <li><p>PerformanceObserver
ç”¨äºç›‘æµ‹æ€§èƒ½åº¦é‡äº‹ä»¶ï¼Œåœ¨æµè§ˆå™¨çš„æ€§èƒ½æ—¶é—´è½´è®°å½•ä¸‹ä¸€ä¸ªæ–°çš„ performance entries çš„æ—¶å€™å°†ä¼šè¢«é€šçŸ¥ã€‚å¯ä»¥ç›‘æ§æ€§èƒ½</p></li> <li><p>ResizeObserver
æ¥å£å¯ä»¥ç›‘å¬åˆ° DOM çš„å˜åŒ–ï¼ˆèŠ‚ç‚¹çš„å‡ºç°å’Œéšè—ï¼ŒèŠ‚ç‚¹å¤§å°çš„å˜åŒ–ï¼‰</p></li> <li><p>ReportingObserver
ReportingObserver: ç›‘å¬è¿‡æ—¶çš„ apiã€æµè§ˆå™¨çš„ä¸€äº›å¹²é¢„è¡Œä¸ºçš„æŠ¥å‘Š</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
    <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">collectAppear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> appearEvent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">'onAppear'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> disappearEvent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">'onDisappear'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> ob<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>ImoocCliMonitorObserver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob <span class="token operator">=</span> window<span class="token punctuation">.</span>ImoocCliMonitorObserver<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>intersectionRatio <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>target<span class="token punctuation">.</span>className <span class="token operator">+</span> <span class="token string">' appear'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          d<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>appearEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>target<span class="token punctuation">.</span>className <span class="token operator">+</span> <span class="token string">' disappear'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          d<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>disappearEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> obList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> appear <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'[appear]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> appear<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>appear<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ob<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>appear<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      obList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>appear<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  window<span class="token punctuation">.</span>MonitorObserver <span class="token operator">=</span> ob<span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>MonitorObserverList <span class="token operator">=</span> obList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'demo2'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'onAppear'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// sendExp({ a: 1, b: 2 }, e);</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com//edit/master/docs/note/å‰ç«¯ç›‘æ§/å‰ç«¯ç›‘æ§.md" target="_blank" rel="noopener noreferrer">åœ¨ Github ä¸Šç¼–è¾‘æ­¤é¡µ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">æ›´æ–°æ—¶é—´:</span> <span class="time">6/19/2022, 9:12:57 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/note/note/æ€§èƒ½/é‡ç»˜å’Œé‡æ’.html" class="prev">
        é‡ç»˜å’Œé‡æ’
      </a></span> <span class="next"><a href="/note/note/webpack/åŸºæœ¬ä½¿ç”¨.html">
        webpack åŸºæœ¬ä½¿ç”¨
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.c6304b87.js" defer></script><script src="/note/assets/js/2.a2d0eb10.js" defer></script><script src="/note/assets/js/4.9d6e3d9e.js" defer></script>
  </body>
</html>
